FROM hashicorp/terraform:1.5.6

ARG ARCH

RUN apk add bash git curl wget && \
  git config --global --add safe.directory '*' && \
  export PATH=$PATH:/usr/local/go/bin:$HOME/go/bin && \
  wget https://go.dev/dl/go1.21.1.linux-$ARCH.tar.gz && \
  tar -xf go1.21.1.linux-$ARCH.tar.gz -C /usr/local && \
  chmod +x /usr/local/go/bin/go && \
  rm go1.21.1.linux-$ARCH.tar.gz

WORKDIR /provider
ADD . ./
RUN /usr/local/go/bin/go install .

ADD containers/.terraformrc /root/.terraformrc

WORKDIR /project
